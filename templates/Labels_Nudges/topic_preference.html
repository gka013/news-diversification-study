{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Media Survey</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Bootstrap 5 CSS -->
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css"
    rel="stylesheet"
    xintegrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC"
    crossorigin="anonymous"
  />

  <!-- Bootstrap Icons -->
  <link
    rel="stylesheet"
    href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css"
  />

  <!-- Google Font: Nunito Sans -->
  <link
    href="https://fonts.googleapis.com/css2?family=Nunito+Sans:wght@300;400;600&display=swap"
    rel="stylesheet"
  />

  <!-- Custom CSS -->
  <style>
    body {
      margin: 0;
      padding: 0;
      background-color: #f7f7f7;
      font-family: 'Nunito Sans', sans-serif;
      color: #333;
    }
    /* Step Indicator */
    .step-indicator {
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 30px;
    }
    .step {
      text-align: center;
      flex: 1 1 0;
      position: relative;
    }
    .step .step-number {
      background-color: #e2e2e2;
      border-radius: 50%;
      width: 32px;
      height: 32px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
      color: #666;
      margin-bottom: 5px;
      margin-left: auto;
      margin-right: auto;
    }
    .step.active .step-number {
      background-color: #007bff;
      color: #fff;
    }
    .step.completed .step-number {
      background-color: #28a745;
      color: #fff;
    }
    .step-title {
      font-size: 0.9rem;
      color: #666;
    }
    .step::after {
      content: '';
      position: absolute;
      width: 100%;
      height: 2px;
      background-color: #e2e2e2;
      top: 16px;
      left: -50%;
      z-index: -1;
    }
    .step:first-child::after {
      content: none;
    }
    .step.active::after,
    .step.completed::after {
      background-color: #007bff;
    }

    /* Main Card */
    .card {
      border: none;
      border-radius: 10px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      background-color: #fff;
      overflow: hidden;
    }
    .card-header,
    .card-body {
      padding: 24px;
    }
    .card-header {
      border-bottom: 1px solid #eee;
    }
    .card-title {
      margin: 0;
      font-weight: 600;
    }

    /* Sub-Card for each section */
    .sub-card {
      position: relative; /* Needed for tooltip positioning */
      border: 1px solid #eee;
      border-radius: 8px;
      background-color: #fafafa;
      padding: 20px;
      margin-bottom: 24px;
    }

    /* Topic Preferences Grid */
    .topics-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 16px;
    }
    .topic-card {
      position: relative; /* Needed for tooltip positioning */
      border: none;
      border-radius: 8px;
      box-shadow: 0 1px 4px rgba(0,0,0,0.08);
      background-color: #fff;
      padding: 15px;
    }
    .topic-card .d-flex {
      align-items: center;
      justify-content: space-between;
    }
    .topic-title {
      font-size: 1rem;
      font-weight: 500;
      margin: 0;
    }

    /* --- Validation Tooltip Styles --- */
    .validation-tooltip {
        position: absolute;
        top: -15px; /* Position above the card's top edge */
        left: 50%;
        transform: translateX(-50%);
        background-color: #fff;
        color: #333;
        padding: 8px 12px;
        border-radius: 6px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        z-index: 10;
        display: flex;
        align-items: center;
        gap: 8px;
        white-space: nowrap;
        border: 1px solid #ddd;
        opacity: 0;
        visibility: hidden;
        transition: opacity 0.3s, visibility 0.3s;
    }
    .validation-tooltip::after { /* The little triangle */
        content: '';
        position: absolute;
        top: 100%;
        left: 50%;
        margin-left: -5px;
        border-width: 5px;
        border-style: solid;
        border-color: #fff transparent transparent transparent;
    }
    .validation-tooltip-icon {
        color: #f0ad4e; /* Orange warning color */
        font-size: 1.2rem;
    }
    .validation-tooltip.show {
        opacity: 1;
        visibility: visible;
    }

    /* Use btn-group for uniform like/dislike buttons */
    .btn-group .btn-icon {
      width: 36px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 6px 0;
    }

    /* Buttons */
    .btn-primary {
      background-color: #007bff;
      border: none;
      border-radius: 6px;
      font-weight: 600;
      padding: 10px 20px;
    }
    .btn-primary:hover {
      background-color: #0056b3;
    }
    footer {
      text-align: center;
      margin: 30px 0;
      color: #666;
      font-size: 0.9rem;
    }
  </style>
</head>
<body>
  <div class="container" style="max-width: 800px; margin-top: 40px; margin-bottom: 40px;">
    <!-- Step Indicator -->
    <div class="step-indicator">
        <div class="step completed"><div class="step-number">1</div><div class="step-title">Start</div></div>
        <div class="step completed"><div class="step-number">2</div><div class="step-title">Personal Info</div></div>
        <div class="step active"><div class="step-number">3</div><div class="step-title">News Preferences</div></div>
        <div class="step"><div class="step-number">4</div><div class="step-title">Evaluation</div></div>
        <div class="step"><div class="step-number">5</div><div class="step-title">Finish</div></div>
    </div>

    <!-- Main Card -->
    <div class="card">
      <div class="card-header">
        <h3 class="card-title">Media Survey</h3>
        <p class="text-muted mb-0">
          Please answer the questions below. Your responses will be treated anonymously.
        </p>
      </div>
      <div class="card-body">
        <form action="" method="POST" onsubmit="return validateForm()">
          {% csrf_token %}

          <!-- Sub-Card: Topic Preferences -->
          <div class="sub-card" id="topics-section">
            <h5 class="mb-3"><strong>Topic Preferences</strong></h5>
            <p class="text-muted">
              Please indicate which topics you like or dislike reading about.
            </p>
            <div class="topics-grid">
              <!-- All topic-card divs have the same structure -->
              <div class="topic-card"><div class="d-flex justify-content-between align-items-center"><p class="topic-title">Politics</p><div class="btn-group" role="group"><button type="button" class="btn btn-outline-success btn-icon" onclick="toggleButton(this, 'like', 'politikk_input')"><i class="bi bi-hand-thumbs-up"></i></button><button type="button" class="btn btn-outline-danger btn-icon" onclick="toggleButton(this, 'dislike', 'politikk_input')"><i class="bi bi-hand-thumbs-down"></i></button></div></div><input type="hidden" name="politikk" id="politikk_input" value="0" class="topic-input" /></div>
              <div class="topic-card"><div class="d-flex justify-content-between align-items-center"><p class="topic-title">Economy & Business</p><div class="btn-group" role="group"><button type="button" class="btn btn-outline-success btn-icon" onclick="toggleButton(this, 'like', 'okonomi_input')"><i class="bi bi-hand-thumbs-up"></i></button><button type="button" class="btn btn-outline-danger btn-icon" onclick="toggleButton(this, 'dislike', 'okonomi_input')"><i class="bi bi-hand-thumbs-down"></i></button></div></div><input type="hidden" name="okonomi_og_naeringsliv" id="okonomi_input" value="0" class="topic-input" /></div>
              <div class="topic-card"><div class="d-flex justify-content-between align-items-center"><p class="topic-title">Crime & Legal Cases</p><div class="btn-group" role="group"><button type="button" class="btn btn-outline-success btn-icon" onclick="toggleButton(this, 'like', 'kriminalitet_input')"><i class="bi bi-hand-thumbs-up"></i></button><button type="button" class="btn btn-outline-danger btn-icon" onclick="toggleButton(this, 'dislike', 'kriminalitet_input')"><i class="bi bi-hand-thumbs-down"></i></button></div></div><input type="hidden" name="kriminalitet_og_rettssaker" id="kriminalitet_input" value="0" class="topic-input" /></div>
              <div class="topic-card"><div class="d-flex justify-content-between align-items-center"><p class="topic-title">Foreign Affairs & Global Conflicts</p><div class="btn-group" role="group"><button type="button" class="btn btn-outline-success btn-icon" onclick="toggleButton(this, 'like', 'utenriks_input')"><i class="bi bi-hand-thumbs-up"></i></button><button type="button" class="btn btn-outline-danger btn-icon" onclick="toggleButton(this, 'dislike', 'utenriks_input')"><i class="bi bi-hand-thumbs-down"></i></button></div></div><input type="hidden" name="utenriks_og_globale_konflikter" id="utenriks_input" value="0" class="topic-input" /></div>
              <div class="topic-card"><div class="d-flex justify-content-between align-items-center"><p class="topic-title">Society & Work Life</p><div class="btn-group" role="group"><button type="button" class="btn btn-outline-success btn-icon" onclick="toggleButton(this, 'like', 'samfunn_input')"><i class="bi bi-hand-thumbs-up"></i></button><button type="button" class="btn btn-outline-danger btn-icon" onclick="toggleButton(this, 'dislike', 'samfunn_input')"><i class="bi bi-hand-thumbs-down"></i></button></div></div><input type="hidden" name="samfunn_og_arbeidsliv" id="samfunn_input" value="0" class="topic-input" /></div>
              <div class="topic-card"><div class="d-flex justify-content-between align-items-center"><p class="topic-title">Climate & Environment</p><div class="btn-group" role="group"><button type="button" class="btn btn-outline-success btn-icon" onclick="toggleButton(this, 'like', 'klima_input')"><i class="bi bi-hand-thumbs-up"></i></button><button type="button" class="btn btn-outline-danger btn-icon" onclick="toggleButton(this, 'dislike', 'klima_input')"><i class="bi bi-hand-thumbs-down"></i></button></div></div><input type="hidden" name="klima_og_miljo" id="klima_input" value="0" class="topic-input" /></div>
              <div class="topic-card"><div class="d-flex justify-content-between align-items-center"><p class="topic-title">Health & Research</p><div class="btn-group" role="group"><button type="button" class="btn btn-outline-success btn-icon" onclick="toggleButton(this, 'like', 'helse_input')"><i class="bi bi-hand-thumbs-up"></i></button><button type="button" class="btn btn-outline-danger btn-icon" onclick="toggleButton(this, 'dislike', 'helse_input')"><i class="bi bi-hand-thumbs-down"></i></button></div></div><input type="hidden" name="helse_og_forskning" id="helse_input" value="0" class="topic-input" /></div>
              <div class="topic-card"><div class="d-flex justify-content-between align-items-center"><p class="topic-title">Entertainment & Celebrities</p><div class="btn-group" role="group"><button type="button" class="btn btn-outline-success btn-icon" onclick="toggleButton(this, 'like', 'underholdning_input')"><i class="bi bi-hand-thumbs-up"></i></button><button type="button" class="btn btn-outline-danger btn-icon" onclick="toggleButton(this, 'dislike', 'underholdning_input')"><i class="bi bi-hand-thumbs-down"></i></button></div></div><input type="hidden" name="underholdning_og_kjendiser" id="underholdning_input" value="0" class="topic-input" /></div>
              <div class="topic-card"><div class="d-flex justify-content-between align-items-center"><p class="topic-title">Lifestyle & Health</p><div class="btn-group" role="group"><button type="button" class="btn btn-outline-success btn-icon" onclick="toggleButton(this, 'like', 'livsstil_input')"><i class="bi bi-hand-thumbs-up"></i></button><button type="button" class="btn btn-outline-danger btn-icon" onclick="toggleButton(this, 'dislike', 'livsstil_input')"><i class="bi bi-hand-thumbs-down"></i></button></div></div><input type="hidden" name="livsstil_og_helse" id="livsstil_input" value="0" class="topic-input" /></div>
              <div class="topic-card"><div class="d-flex justify-content-between align-items-center"><p class="topic-title">Food & Drink</p><div class="btn-group" role="group"><button type="button" class="btn btn-outline-success btn-icon" onclick="toggleButton(this, 'like', 'matdrikke_input')"><i class="bi bi-hand-thumbs-up"></i></button><button type="button" class="btn btn-outline-danger btn-icon" onclick="toggleButton(this, 'dislike', 'matdrikke_input')"><i class="bi bi-hand-thumbs-down"></i></button></div></div><input type="hidden" name="mat_og_drikke" id="matdrikke_input" value="0" class="topic-input" /></div>
              <div class="topic-card"><div class="d-flex justify-content-between align-items-center"><p class="topic-title">Technology & Science</p><div class="btn-group" role="group"><button type="button" class="btn btn-outline-success btn-icon" onclick="toggleButton(this, 'like', 'techvit_input')"><i class="bi bi-hand-thumbs-up"></i></button><button type="button" class="btn btn-outline-danger btn-icon" onclick="toggleButton(this, 'dislike', 'techvit_input')"><i class="bi bi-hand-thumbs-down"></i></button></div></div><input type="hidden" name="teknologi_og_vitenskap" id="techvit_input" value="0" class="topic-input" /></div>
              <div class="topic-card"><div class="d-flex justify-content-between align-items-center"><p class="topic-title">Sport</p><div class="btn-group" role="group"><button type="button" class="btn btn-outline-success btn-icon" onclick="toggleButton(this, 'like', 'sport_input')"><i class="bi bi-hand-thumbs-up"></i></button><button type="button" class="btn btn-outline-danger btn-icon" onclick="toggleButton(this, 'dislike', 'sport_input')"><i class="bi bi-hand-thumbs-down"></i></button></div></div><input type="hidden" name="sport" id="sport_input" value="0" class="topic-input" /></div>
            </div>
          </div>

          <!-- Other form sections -->
          <div class="sub-card" id="media-usage-section">
            <h5 class="mb-3"><strong>Use of Different Media</strong></h5>
            <p class="text-muted">How often and how long do you use the following media?</p>
            <div class="form-check"><input class="form-check-input" type="radio" name="media_usage" id="usage_daily" value="daily"><label class="form-check-label" for="usage_daily">Daily</label></div>
            <div class="form-check"><input class="form-check-input" type="radio" name="media_usage" id="usage_weekly" value="weekly"><label class="form-check-label" for="usage_weekly">Weekly</label></div>
            <div class="form-check"><input class="form-check-input" type="radio" name="media_usage" id="usage_monthly" value="monthly"><label class="form-check-label" for="usage_monthly">Monthly</label></div>
            <div class="form-check"><input class="form-check-input" type="radio" name="media_usage" id="usage_rarely" value="rarely"><label class="form-check-label" for="usage_rarely">Rarely/Never</label></div>
          </div>
          <div class="sub-card" id="media-access-section">
            <h5 class="mb-3"><strong>Access to Media</strong></h5>
            <p class="text-muted">Which media and devices do you (or your household) have access to?</p>
            <div class="form-check"><input class="form-check-input media-access-checkbox" type="checkbox" id="access_internet" value="internet"><label class="form-check-label" for="access_internet">Internet</label></div>
            <div class="form-check"><input class="form-check-input media-access-checkbox" type="checkbox" id="access_smartphone" value="smartphone"><label class="form-check-label" for="access_smartphone">Smartphone</label></div>
            <div class="form-check"><input class="form-check-input media-access-checkbox" type="checkbox" id="access_tablet" value="tablet"><label class="form-check-label" for="access_tablet">Tablet</label></div>
            <div class="form-check"><input class="form-check-input media-access-checkbox" type="checkbox" id="access_streaming" value="streaming"><label class="form-check-label" for="access_streaming">Streaming Services</label></div>
            <input type="hidden" name="media_access" id="media_access_hidden" value="">
          </div>
          <!-- MODIFIED: Added an ID to this section for validation -->
          <div class="sub-card" id="news-source-section">
            <h5 class="mb-3"><strong>Media Use for News and Information</strong></h5>
            <p class="text-muted">Which media do you use to keep yourself updated on politics and news?</p>
            <div class="form-check"><input class="form-check-input" type="checkbox" name="news_source" value="papers"><label class="form-check-label" for="news_papers">Newspapers (print/online)</label></div>
            <div class="form-check"><input class="form-check-input" type="checkbox" name="news_source" value="tv"><label class="form-check-label" for="news_tv">TV Channels</label></div>
            <div class="form-check"><input class="form-check-input" type="checkbox" name="news_source" value="radio"><label class="form-check-label" for="news_radio">Radio</label></div>
            <div class="form-check"><input class="form-check-input" type="checkbox" name="news_source" value="social"><label class="form-check-label" for="news_social">Social Media</label></div>
          </div>

          <!-- Submit Button -->
          <div class="d-flex justify-content-end">
            <button type="submit" class="btn btn-primary">Next</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <footer>
    &#169; DARS RESEARCH GROUP
  </footer>

  <script>
    function toggleButton(button, type, hiddenInputId) {
        let container = button.parentElement;
        let hiddenInput = document.getElementById(hiddenInputId);

        const topicCard = button.closest('.topic-card');
        if (topicCard) {
          const existingTooltip = topicCard.querySelector('.validation-tooltip');
          if (existingTooltip) existingTooltip.remove();
        }

        if (type === 'like') {
            if (button.classList.contains('btn-success')) {
                button.classList.replace('btn-success', 'btn-outline-success');
                hiddenInput.value = 0;
            } else {
                button.classList.replace('btn-outline-success', 'btn-success');
                let sib = container.querySelector('.btn-danger');
                if (sib) sib.classList.replace('btn-danger', 'btn-outline-danger');
                hiddenInput.value = 1;
            }
        } else {
            if (button.classList.contains('btn-danger')) {
                button.classList.replace('btn-danger', 'btn-outline-danger');
                hiddenInput.value = 0;
            } else {
                button.classList.replace('btn-outline-danger', 'btn-danger');
                let sib = container.querySelector('.btn-success');
                if (sib) sib.classList.replace('btn-success', 'btn-outline-success');
                hiddenInput.value = -1;
            }
        }
    }

    // --- MODIFIED: showTooltip now makes tooltips disappear ---
    function showTooltip(element, message) {
        const tooltip = document.createElement('div');
        tooltip.className = 'validation-tooltip';
        tooltip.innerHTML = `<i class="bi bi-exclamation-triangle-fill validation-tooltip-icon"></i> ${message}`;
        element.appendChild(tooltip);

        // Fade in
        setTimeout(() => tooltip.classList.add('show'), 10);

        // After 3 seconds, fade out, then remove from the page
        setTimeout(() => {
            tooltip.classList.remove('show');
            setTimeout(() => {
                if (tooltip.parentElement) {
                    tooltip.parentElement.removeChild(tooltip);
                }
            }, 300); // Wait for fade out transition to finish
        }, 3000);
    }

    // --- UPDATED: Comprehensive Validation Script ---
    function validateForm() {
        prepareMediaAccess();
        let firstErrorElement = null;

        document.querySelectorAll('.validation-tooltip').forEach(tip => tip.remove());

        // Check #1: Topic Preferences
        const topicInputs = document.querySelectorAll('.topic-input');
        for (const input of topicInputs) {
            if (input.value === '0') {
                const topicCard = input.closest('.topic-card');
                if (!firstErrorElement) firstErrorElement = topicCard;
            }
        }
        if (firstErrorElement) {
            showTooltip(firstErrorElement, 'Please select one of these options.');
            firstErrorElement.scrollIntoView({ behavior: 'smooth', block: 'center' });
            return false;
        }

        // Check #2: "Use of Different Media"
        if (!document.querySelector('input[name="media_usage"]:checked')) {
            const section = document.getElementById('media-usage-section');
            showTooltip(section, 'Please select one option for media usage.');
            section.scrollIntoView({ behavior: 'smooth', block: 'center' });
            return false;
        }

        // Check #3: "Access to Media"
        if (document.getElementById('media_access_hidden').value === '') {
            const section = document.getElementById('media-access-section');
            showTooltip(section, 'Please select at least one option for media access.');
            section.scrollIntoView({ behavior: 'smooth', block: 'center' });
            return false;
        }

        // Check #4: "Media Use for News and Information"
        if (!document.querySelector('input[name="news_source"]:checked')) {
            const section = document.getElementById('news-source-section');
            showTooltip(section, 'Please select at least one source for news.');
            section.scrollIntoView({ behavior: 'smooth', block: 'center' });
            return false;
        }

        return true; // All good, proceed with submission
    }

    function prepareMediaAccess() {
      let vals = [];
      document.querySelectorAll('.media-access-checkbox').forEach(cb=>{
        if(cb.checked) vals.push(cb.value);
      });
      document.getElementById('media_access_hidden').value = vals.join(',');
    }
  </script>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
          xintegrity="sha384-cVKIPhG1+K+o6f9bdxI3p1h4w7rZxKO2K3SKm3w7S5z4Qgf6X3p8jq/6C0yKp6wk"
          crossorigin="anonymous"></script>
</body>
</html>
